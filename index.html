<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Terra Classic</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #000;
  font-family: Arial, sans-serif;
}

#gameCanvas {
  display: none;
  margin: auto;
  background: #FFD700;
  image-rendering: pixelated;
}

#ui {
  position: absolute;
  top: 10px;
  left: 10px;
  color: black;
  font-weight: bold;
  z-index: 10;
  display: none;
}

button {
  padding: 10px;
  margin: 5px;
  border: none;
  background: #003366;
  color: white;
  border-radius: 5px;
  cursor: pointer;
  width: 230px;
}

#menuBox, #connectChoice {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  background: #FFD700;
  padding: 30px;
  border-radius: 10px;
  text-align: center;
}

.panel {
  display: none;
  text-align: center;
  margin-top: 50px;
}
</style>
</head>
<body>

<div id="ui">
  <div id="walletStatus"></div>
  <button onclick="disconnectWallet()">Disconnect</button>
  <div>Score: <span id="score">0</span></div>
  <div>Highscore: <span id="highscore">0</span></div>
</div>

<div id="menuBox">
  <h2>Main Menu</h2>
  <button onclick="showConnectOptions()">Play Game</button><br>
</div>

<div id="connectChoice" style="display:none;">
  <h3>Choose Wallet</h3>
  <button onclick="connectDesktop()">ðŸ–¥ Connect Desktop</button><br>
  <button onclick="backToMenu()">Back</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

// ===== LOAD IMAGE =====
const birdImg = new Image();
birdImg.src = "terra.png";

// ===== STATE =====
let walletConnected = false;
let connectedWallet = null;
let gameRunning = false;

let birdY = 200;
let velocity = 0;
let gravity = 1200;
let jumpForce = -450;

let pipes = [];
let pipeTimer = 0;
let pipeInterval = 2;

let score = 0;
let highscore = localStorage.getItem("highscore") || 0;
document.getElementById("highscore").innerText = highscore;

let lastTime = 0;
let gameOver = false;
let gameSaved = false;

const birdSize = 60;
const pipeWidth = 70;
const pipeGap = 200;
const pipeSpeed = 200;

// ===== MENU CONTROL =====
function showConnectOptions(){
  document.getElementById("menuBox").style.display="none";
  document.getElementById("connectChoice").style.display="block";
}

function backToMenu(){
  document.getElementById("connectChoice").style.display="none";
  document.getElementById("menuBox").style.display="block";
}

// ===== DESKTOP CONNECT =====
async function connectDesktop(){
  if(!window.keplr){
    alert("Keplr Extension not detected");
    return;
  }

  try{
    await window.keplr.enable("columbus-5");
    const signer = window.getOfflineSigner("columbus-5");
    const accounts = await signer.getAccounts();

    connectedWallet = accounts[0].address;
    walletConnected = true;

    startGame();
  }catch{
    alert("Connection failed");
  }
}

// ===== START GAME =====
function startGame(){
  document.getElementById("connectChoice").style.display="none";
  document.getElementById("ui").style.display="block";
